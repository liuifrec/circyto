# circCyto

[![CI](https://github.com/liuifrec/circyto/actions/workflows/test.yml/badge.svg?branch=main)](https://github.com/liuifrec/circyto/actions/workflows/test.yml)
[![release](https://img.shields.io/github/v/release/liuifrec/circyto?display_name=tag)](https://github.com/liuifrec/circyto/releases)

<p align="center">
  <img src="assets/circCyto_logo.png" alt="circCyto logo" width="480">
</p>

---

A **Python CLI toolkit** for **single-cell circRNA detection, merging, and conversion**.  
Supports modular detectors (`CIRI-full`, `CIRI-long`, `find_circ`, `CIRCexplorer2`) and  
outputs sparse matrices ready for downstream analysis in **Scanpy**, **scVelo**, etc.

---

## ðŸ§¬ Installation

```bash
git clone https://github.com/liuifrec/circyto.git
cd circyto
pip install -e .
(Optional) install with extra detector tools:

bash
Copy code
pip install -e .[detectors]
âš™ï¸ Commands
Command	Description
circyto prepare	10x BAM â†’ batched FASTQs (`--chemistry tenx-3p
circyto run	Run CIRI-full on FASTQ batches generated by prepare
circyto run-manifest	Run CIRI-full using a per-cell manifest TSV (recommended for Smart-seq/plate data)
circyto collect	Merge all CIRI outputs into a circÃ—cell sparse matrix
circyto convert	Convert .mtx + index files into .loom or .h5ad for Scanpy/scVelo
circyto make	All-in-one pipeline (auto-detects manifest or BAM input)

ðŸ“„ Manifest format (for plate/full-length protocols)
A tab-delimited file with headers:

bash
Copy code
cell_id    r1                     r2
A01        /data/A01_R1.fastq.gz  /data/A01_R2.fastq.gz
A02        /data/A02_R1.fastq.gz  /data/A02_R2.fastq.gz
For single-end protocols, omit r2 or leave it blank.

ðŸš€ Example usage
Plate (Smart-seq, RamDA-seq, Quartz-seq, etc.)
bash
Copy code
circyto make \
  --manifest cells.tsv \
  --ref-fa ref.fa \
  --gtf genes.gtf \
  --outdir work \
  --threads 32 \
  --cmd-template 'CIRI-full -r {ref_fa} -a {gtf} -1 {r1} -2 {r2} -o {out_tsv}'
10x Genomics 5â€² or 3â€²
bash
Copy code
circyto make \
  --bam possorted_genome_bam.bam \
  --chemistry tenx-5p \
  --ref-fa ref.fa \
  --gtf genes.gtf \
  --outdir work \
  --threads 16 \
  --cmd-template 'CIRI-full -r {ref_fa} -a {gtf} -1 {r1} -2 {r2} -o {out_tsv}'
Note: For 10x BAM, R1/R2 reconstruction is heuristic â€” plate/manifest mode gives the most accurate per-cell FASTQs.

ðŸ§ª Example workflow (using dummy FASTQs)
bash
Copy code
# 1. Prepare fake FASTQ batches
circyto prepare --bam tests/mini_R1.fastq --outdir tests/fastq_batches

# 2. Run a placeholder detection (writes minimal TSVs)
circyto run \
  --fastq-dir tests/fastq_batches \
  --outdir tests/out_ciri-full \
  --ref-fa tests/mini_R1.fastq \
  --gtf tests/mini_R2.fastq \
  --cmd-template 'bash -lc '\''printf "circ_id\tchr\tstart\tend\tstrand\tsupport\n" > {out_tsv}'\'''

# 3. Merge results into sparse matrix
circyto collect \
  --cirifull-dir tests/out_ciri-full \
  --matrix tests/circ.mtx \
  --circ-index tests/circ_ids.txt \
  --cell-index tests/cell_ids.txt

# 4. Convert to .loom for Scanpy
circyto convert \
  --matrix tests/circ.mtx \
  --circ-index tests/circ_ids.txt \
  --cell-index tests/cell_ids.txt \
  --loom tests/circ_full.loom
ðŸ“‚ Project structure
pgsql
Copy code
circyto/
â”œâ”€â”€ cli/              # Typer-based command definitions
â”œâ”€â”€ detectors/        # CIRI-full, CIRI-long, etc.
â”œâ”€â”€ parsers/          # Output parsers
â”œâ”€â”€ pipeline/         # Workflow orchestration (prepare, run, collect)
â”œâ”€â”€ writers/          # Loom/h5ad/sparse conversion
â”œâ”€â”€ tests/            # Smoke test assets
â””â”€â”€ assets/           # Logos and misc
ðŸ§© Continuous Integration
GitHub Actions run on every push to main:

installs package with extras

runs CLI smoke tests (bash tests/test_cli.sh)

ensures all core commands (prepare, run, collect, convert) execute without error

View status âžœ CI Actions Dashboard

ðŸ“– Citation (manuscript in preparation)
Liu, Y.-C. et al. circCyto â€” a modular toolkit for single-cell circRNA profiling and integration with scRNA-seq workflows. (Manuscript in preparation, 2025).

ðŸ“œ License
MIT License Â© 2025 Yusei (James) Liu