# CLI policy

This page documents the CLI conventions and “where do I put the detector/outdir?” rules that are easy to forget.

The core motivation: a user should not need to memorize Typer quirks or guess argument positions.

---

## Golden rules

1. Prefer `run-batch` unless you have a strong reason not to.
2. Always set an explicit output directory (`--outdir` or positional OUTDIR).
3. When in doubt, put paths early and run with `--help`.

---

## The “truth table”

### `run-batch` (single detector; recommended)

- Detector is a flag: `--detector`
- Output directory is a flag: `--outdir`

```bash
circyto run-batch \
  --detector <DETECTOR> \
  --manifest manifest.tsv \
  --outdir work/<run_name> \
  --ref-fa ref/genome.fa \
  --gtf ref/genes.gtf \
  --threads 8 \
  --parallel 4
```

### `run-detector` (single detector)

- Detector is positional (immediately after `run-detector`)
- Output directory is a flag: `--outdir`

```bash
circyto run-detector <DETECTOR> \
  --manifest manifest.tsv \
  --outdir work/<run_name> \
  --ref-fa ref/genome.fa \
  --gtf ref/genes.gtf \
  --threads 8
```

### `run-multidetector` (multiple detectors)

- Detectors are positional
- OUTDIR is positional and comes last (required)

```bash
circyto run-multidetector \
  <DETECTOR_A> <DETECTOR_B> [<DETECTOR_C> ...] \
  work/<run_name> \
  --manifest manifest.tsv \
  --ref-fa ref/genome.fa \
  --gtf ref/genes.gtf \
  --threads 8 \
  --parallel 2
```

### `collect-matrix` (unified collector)

- Detector is a flag: `--detector`
- Input directory is a flag: `--indir`
- Output paths are explicit flags

```bash
circyto collect-matrix \
  --detector <DETECTOR> \
  --indir work/<run_name> \
  --matrix work/<run_name>_matrix/circ_counts.mtx \
  --circ-index work/<run_name>_matrix/circ_index.txt \
  --cell-index work/<run_name>_matrix/cell_index.txt
```

---

## Why a `circyto detectors` command is needed (planned)

Typer’s autogenerated help does not naturally list “all detector choices” when detectors are implemented as pluggable units.

Planned UX:

- `circyto detectors` prints:
  - detector name
  - a one-line description
  - required external executables (if any)
  - whether the detector needs a GTF, genome index, etc.

This avoids the “read the README to find detector names” trap.

---

## Why a `circyto doctor` command is needed (planned)

Many failures happen before circyto can do meaningful work, e.g.:

- `bowtie2` / `samtools` missing
- `bwa` missing
- `java` missing or too old
- `STAR` optional but required for STAR-based detectors

Planned UX:

- `circyto doctor` prints a report of what is found on PATH and what is missing,
  plus suggested install hints per OS family (where feasible).

---

## Stability expectations

- Flags and core semantics should be stable across minor versions where possible.
- If a breaking change is required, it should:
  - be documented in `CHANGELOG.md`
  - be called out in `ROADMAP.md`
  - ship with a migration note in `docs/getting_started.md`
